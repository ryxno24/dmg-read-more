(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,r=window.wp.blocks,a=window.wp.i18n,o=window.wp.apiFetch;var l=e.n(o);const n=window.wp.blockEditor,s=window.wp.components,d=window.wp.element;(0,r.registerBlockType)("dmg/read-more",{edit:({attributes:e,setAttributes:r})=>{const{postId:o,postTitle:i,postUrl:m}=e,c=(0,n.useBlockProps)(),[p,u]=(0,d.useState)(""),[g,_]=(0,d.useState)([]),[w,E]=(0,d.useState)([]),[h,v]=(0,d.useState)(!1),[y,b]=(0,d.useState)(1),[k,f]=(0,d.useState)(1),[S,C]=(0,d.useState)("");(0,d.useEffect)(()=>{B()},[]);const B=(0,d.useCallback)(async()=>{v(!0);try{const e=await l()({path:"/wp/v2/posts?per_page=10&status=publish&_fields=id,title,link"});E(e)}catch(e){C((0,a.__)("Failed to load recent posts","dmg-read-more"))}v(!1)},[]),x=(0,d.useCallback)(async(e,t=1)=>{const r=e||p;if(r.trim()){v(!0),C("");try{let e;if(/^\d+$/.test(r.trim())){e=`/wp/v2/posts/${r.trim()}?_fields=id,title,link`;const t=await l()({path:e});_([t]),f(1),b(1)}else{e=`/wp/v2/posts?search=${encodeURIComponent(r)}&per_page=10&page=${t}&status=publish&_fields=id,title,link`;const a=await l()({path:e,parse:!1}),o=await a.json(),n=a.headers.get("X-WP-TotalPages");_(o),f(parseInt(n,10)||1),b(t)}}catch(e){"rest_post_invalid_id"===e.code?(_([]),C((0,a.__)("Post not found","dmg-read-more"))):C((0,a.__)("Search failed","dmg-read-more"))}v(!1)}else _([])},[p]),P=(0,d.useCallback)(e=>{r({postId:e.id,postTitle:e.title.rendered,postUrl:e.link})},[r]),I=(0,d.useCallback)(()=>{r({postId:0,postTitle:"",postUrl:""})},[r]),N=({posts:e,title:r})=>(0,t.createElement)("div",null,(0,t.createElement)("h4",null,r),0===e.length?(0,t.createElement)("p",null,(0,a.__)("No posts found","dmg-read-more")):(0,t.createElement)("ul",{style:{margin:0,padding:0,listStyle:"none"}},e.map(e=>{const r=e.id===o;return(0,t.createElement)("li",{key:e.id,style:{marginBottom:"8px"}},(0,t.createElement)(s.Button,{variant:r?"primary":"secondary",onClick:()=>P(e),style:{width:"100%",textAlign:"left",whiteSpace:"normal",height:"auto",padding:"8px",backgroundColor:r?"#0073aa":void 0,color:r?"white":void 0,borderColor:r?"#0073aa":void 0}},r&&"âœ“ ",e.title.rendered||(0,a.__)("(No title)","dmg-read-more")))})));return(0,t.createElement)("div",{...c},(0,t.createElement)(n.InspectorControls,null,(0,t.createElement)(s.PanelBody,{title:(0,a.__)("Post Selection","dmg-read-more"),initialOpen:!0},(0,t.createElement)(s.TextControl,{label:(0,a.__)("Search posts or enter post ID","dmg-read-more"),value:p,onChange:u,placeholder:(0,a.__)("Enter search term or post ID...","dmg-read-more")}),(0,t.createElement)("div",{style:{marginBottom:"16px"}},(0,t.createElement)(s.Button,{variant:"primary",onClick:()=>x(),disabled:h||!p.trim()},(0,a.__)("Search","dmg-read-more")),o>0&&(0,t.createElement)(s.Button,{variant:"secondary",onClick:I,style:{marginLeft:"8px"}},(0,a.__)("Clear Selection","dmg-read-more"))),h&&(0,t.createElement)(s.Spinner,null),S&&(0,t.createElement)(s.Notice,{status:"error",isDismissible:!1},S),g.length>0&&(0,t.createElement)("div",{style:{marginBottom:"20px"}},(0,t.createElement)(N,{posts:g,title:(0,a.__)("Search Results","dmg-read-more")}),k>1&&(0,t.createElement)("div",{style:{marginTop:"12px",textAlign:"center"}},(0,t.createElement)(s.Button,{variant:"secondary",disabled:y<=1||h,onClick:()=>x(p,y-1)},(0,a.__)("Previous","dmg-read-more")),(0,t.createElement)("span",{style:{margin:"0 12px"}},y," / ",k),(0,t.createElement)(s.Button,{variant:"secondary",disabled:y>=k||h,onClick:()=>x(p,y+1)},(0,a.__)("Next","dmg-read-more")))),!p.trim()&&w.length>0&&(0,t.createElement)(N,{posts:w,title:(0,a.__)("Recent Posts","dmg-read-more")}))),(0,t.createElement)("div",{className:"dmg-read-more-block-editor"},o>0?(0,t.createElement)("p",{className:"dmg-read-more"},(0,t.createElement)("a",{href:m},(0,a.__)("Read More: ","dmg-read-more"),i)):(0,t.createElement)("p",{className:"dmg-read-more-placeholder"},(0,a.__)('Select a post to create a "Read More" link.',"dmg-read-more"))))},save:({attributes:e})=>{const{postId:r,postTitle:o,postUrl:l}=e,s=n.useBlockProps.save();return r&&o&&l?(0,t.createElement)("p",{...s,className:"dmg-read-more"},(0,t.createElement)("a",{href:l},(0,a.__)("Read More: ","dmg-read-more"),o)):null}})})();