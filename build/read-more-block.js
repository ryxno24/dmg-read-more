(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.React,r=window.wp.blocks,a=window.wp.i18n,o=window.wp.blockEditor,l=window.wp.components,n=window.wp.element,s=window.wp.apiFetch;var d=e.n(s);(0,r.registerBlockType)("dmg/read-more",{edit:({attributes:e,setAttributes:r})=>{const{postId:s,postTitle:i,postUrl:m}=e,[c,p]=(0,n.useState)(""),[g,u]=(0,n.useState)([]),[_,E]=(0,n.useState)([]),[h,w]=(0,n.useState)(!1),[v,y]=(0,n.useState)(1),[b,f]=(0,n.useState)(1),[k,S]=(0,n.useState)(""),B=(0,o.useBlockProps)();(0,n.useEffect)(()=>{C()},[]);const C=async()=>{w(!0);try{const e=await d()({path:"/wp/v2/posts?per_page=10&status=publish&_fields=id,title,link"});E(e)}catch(e){S((0,a.__)("Failed to load recent posts","dmg-read-more"))}w(!1)},x=async(e=c,t=1)=>{if(e.trim()){w(!0),S("");try{let r;if(/^\d+$/.test(e.trim())){r=`/wp/v2/posts/${e.trim()}?_fields=id,title,link`;const t=await d()({path:r});u([t]),f(1),y(1)}else{r=`/wp/v2/posts?search=${encodeURIComponent(e)}&per_page=10&page=${t}&status=publish&_fields=id,title,link`;const a=await d()({path:r,parse:!1}),o=await a.json(),l=a.headers.get("X-WP-TotalPages");u(o),f(parseInt(l)||1),y(t)}}catch(e){"rest_post_invalid_id"===e.code?(u([]),S((0,a.__)("Post not found","dmg-read-more"))):S((0,a.__)("Search failed","dmg-read-more"))}w(!1)}else u([])},P=({posts:e,title:o})=>(0,t.createElement)("div",null,(0,t.createElement)("h4",null,o),0===e.length?(0,t.createElement)("p",null,(0,a.__)("No posts found","dmg-read-more")):(0,t.createElement)("ul",{style:{margin:0,padding:0,listStyle:"none"}},e.map(e=>{const o=e.id===s;return(0,t.createElement)("li",{key:e.id,style:{marginBottom:"8px"}},(0,t.createElement)(l.Button,{variant:o?"primary":"secondary",onClick:()=>(e=>{r({postId:e.id,postTitle:e.title.rendered,postUrl:e.link})})(e),style:{width:"100%",textAlign:"left",whiteSpace:"normal",height:"auto",padding:"8px",backgroundColor:o?"#0073aa":void 0,color:o?"white":void 0,borderColor:o?"#0073aa":void 0}},o&&"âœ“ ",e.title.rendered||(0,a.__)("(No title)","dmg-read-more")))})));return(0,t.createElement)("div",{...B},(0,t.createElement)(o.InspectorControls,null,(0,t.createElement)(l.PanelBody,{title:(0,a.__)("Post Selection","dmg-read-more"),initialOpen:!0},(0,t.createElement)(l.TextControl,{label:(0,a.__)("Search posts or enter post ID","dmg-read-more"),value:c,onChange:p,placeholder:(0,a.__)("Enter search term or post ID...","dmg-read-more")}),(0,t.createElement)("div",{style:{marginBottom:"16px"}},(0,t.createElement)(l.Button,{variant:"primary",onClick:()=>x(),disabled:h||!c.trim()},(0,a.__)("Search","dmg-read-more")),s>0&&(0,t.createElement)(l.Button,{variant:"secondary",onClick:()=>{r({postId:0,postTitle:"",postUrl:""})},style:{marginLeft:"8px"}},(0,a.__)("Clear Selection","dmg-read-more"))),h&&(0,t.createElement)(l.Spinner,null),k&&(0,t.createElement)(l.Notice,{status:"error",isDismissible:!1},k),g.length>0&&(0,t.createElement)("div",{style:{marginBottom:"20px"}},(0,t.createElement)(P,{posts:g,title:(0,a.__)("Search Results","dmg-read-more")}),b>1&&(0,t.createElement)("div",{style:{marginTop:"12px",textAlign:"center"}},(0,t.createElement)(l.Button,{variant:"secondary",disabled:v<=1||h,onClick:()=>x(c,v-1)},(0,a.__)("Previous","dmg-read-more")),(0,t.createElement)("span",{style:{margin:"0 12px"}},v," / ",b),(0,t.createElement)(l.Button,{variant:"secondary",disabled:v>=b||h,onClick:()=>x(c,v+1)},(0,a.__)("Next","dmg-read-more")))),""===c&&_.length>0&&(0,t.createElement)(P,{posts:_,title:(0,a.__)("Recent Posts","dmg-read-more")}))),(0,t.createElement)("div",{className:"dmg-read-more-block-editor"},s>0?(0,t.createElement)("p",{className:"dmg-read-more"},(0,t.createElement)("a",{href:m,target:"_blank",rel:"noopener noreferrer"},(0,a.__)("Read More: ","dmg-read-more"),i)):(0,t.createElement)("div",{className:"dmg-read-more-placeholder"},(0,t.createElement)("p",null,(0,a.__)('Select a post from the sidebar to create a "Read More" link.',"dmg-read-more")))))},save:({attributes:e})=>{const{postId:r,postTitle:l,postUrl:n}=e,s=o.useBlockProps.save();return r&&l&&n?(0,t.createElement)("p",{...s,className:"dmg-read-more"},(0,t.createElement)("a",{href:n},(0,a.__)("Read More: ","dmg-read-more"),l)):null}})})();